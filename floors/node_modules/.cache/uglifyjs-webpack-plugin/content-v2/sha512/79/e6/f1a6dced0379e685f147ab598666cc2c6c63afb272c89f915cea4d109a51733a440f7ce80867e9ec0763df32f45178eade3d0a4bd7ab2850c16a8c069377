{"map":"{\"version\":3,\"sources\":[\"/Users/tony/Documents/notes/floors/app/js/game_controller.js\"],\"names\":[\"__webpack_require__\",\"window\",\"requestAnimationFrame\",\"webkitRequestAnimationFrame\",\"mozRequestAnimationFrame\",\"cb\",\"GameController\",\"this\",\"floorRate\",\"name\",\"rate\",\"fps\",\"speed\",\"maxSpeed\",\"peopleVerticalSpeed\",\"animation\",\"canvasWidth\",\"canvasHeight\",\"floorWidth\",\"floorHeight\",\"floorDeltaY\",\"floorScore\",\"blood\",\"$container\",\"$\",\"$canvas\",\"$scroller\",\"$people\",\"peopleRotateZ\",\"peopleRotateDelta\",\"peopleHeight\",\"peopleWidth\",\"_t\",\"_currentScrollerY\",\"_currentPeopleY\",\"_currentPeopleVertical\",\"_floorScrollerY\",\"_maxJumpDistance\",\"_frameIndex\",\"_v0\",\"checkFloorConfig\",\"prototype\",\"constructor\",\"Event\",\"on\",\"event\",\"fn\",\"indexOf\",\"gameover\",\"stop\",\"setTimeout\",\"hide\",\"show\",\"bind\",\"totalRate\",\"config\",\"i\",\"length\",\"_rate\",\"TypeError\",\"RangeError\",\"_floorRateArray\",\"getRandowFloor\",\"rangeArray\",\"dice\",\"Math\",\"random\",\"createFloorSpan\",\"_top\",\"_left\",\"floorElement\",\"css\",\"top\",\"left\",\"width\",\"height\",\"appendTo\",\"removeFloorSapn\",\"eq\",\"remove\",\"updateScore\",\"updateBlood\",\"$bloodEle\",\"removeClass\",\"addClass\",\"trigger\",\"text\",\"loseBlood\",\"__onFloor\",\"addBlood\",\"floorNormal\",\"floorNail\",\"floorWeak\",\"$floorEle\",\"cross\",\"floorScroll\",\"direction\",\"__floorScrollDirection\",\"floorScrollEnd\",\"floorSpring\",\"jumpStart\",\"jumpEnd\",\"people\",\"floorUpdateView\",\"peopleUpdateView\",\"peopleUserController\",\"core\",\"run\",\"reRun\",\"backup\",\"start\",\"floorLoop\",\"$this\",\"canvas\",\"parseInt\"],\"mappings\":\"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\",\"sourcesContent\":[\"import './zepto-touch';\\n\\nwindow.requestAnimationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || function (cb) {\\n    cb();\\n}\\n\\nvar GameController = function () {\\n    this.floorRate = [{\\n            name: 'normal',\\n            rate: 15,\\n        },\\n        {\\n            name: 'spring',\\n            rate: 15\\n        },\\n        {\\n            name: 'weak',\\n            rate: 15\\n        },\\n        {\\n            name: 'scroller-left',\\n            rate: 10\\n        },\\n        {\\n            name: 'scroller-right',\\n            rate: 10\\n        },\\n        {\\n            name: 'nail',\\n            rate: 35\\n        },\\n    ];\\n    this.fps = 60; //刷新频率\\n    this.speed = 50; //卷轴初始速度\\n    this.maxSpeed = 350; //卷轴最大速度\\n    this.peopleVerticalSpeed = 200; //人物横向移动速度\\n    this.animation = null;\\n    this.canvasWidth = 0; //画布宽度\\n    this.canvasHeight = 0; //画面高度\\n    this.floorWidth = 0; //楼层宽度\\n    this.floorHeight = 0; //楼层高度\\n    this.floorDeltaY = 50;\\n    this.floorScore = 1;\\n    this.blood = 12; //人物血量\\n    this.$container = $('.container');\\n    this.$canvas = $('.game-canvas');\\n    this.$scroller = $('.scroller');\\n    this.$people = $('.people');\\n    this.peopleRotateZ = 0;\\n    this.peopleRotateDelta = 25; //小球滚动角度\\n    this.peopleHeight = 0;\\n    this.peopleWidth = 0;\\n    this._t = 0;\\n    this._currentScrollerY = 0;\\n    this._currentPeopleY = 20;\\n    this._currentPeopleVertical = 0;\\n    this._floorScrollerY = 200;\\n    this._maxJumpDistance = 0;\\n    this._frameIndex = 0;\\n    this._v0 = 0;\\n    this.checkFloorConfig();\\n};\\n\\nGameController.prototype = {\\n    constructor: GameController,\\n    Event: [\\n        'gameover',\\n        'start',\\n        'rerun',\\n        'stop',\\n        'scoreupdate'\\n    ],\\n    on: function (event, fn) {\\n        if (this.Event.indexOf(event) === -1) return;\\n        this.$container.on(event, fn);\\n    },\\n    /**\\n     * 游戏结束\\n     */\\n    gameover: function () {\\n        this.stop();\\n        setTimeout(function () {\\n            $('#game-ct').hide();\\n            $('.game-over').show();\\n        }.bind(this), 200);\\n    },\\n    checkFloorConfig: function () {\\n        var rangeArray = [0];\\n        var totalRate = 0;\\n        var config = this.floorRate;\\n\\n        for (var i = 0; i < config.length; i++) {\\n            var _rate=config[i].rate;\\n            if(typeof _rate!=='number'){\\n                throw new TypeError('rate type error');\\n            }\\n            totalRate+=_rate;\\n        }\\n        if (totalRate !== 100) {\\n            throw new RangeError('rate 加起来务必等于100!');\\n        }\\n        this._floorRateArray = rangeArray;\\n    },\\n    getRandowFloor: function (rangeArray) {\\n        var dice = Math.random() * 100;\\n        for (var i = 0; i < rangeArray.length - 1; i++) {\\n            if (dice >= rangeArray[i] && dice < rangeArray[i + 1]) {\\n                return this.floorRate[i];\\n            }\\n        }\\n    },\\n    /**\\n     * 创建楼层\\n     */\\n    createFloorSpan: function () {\\n        var _top = this._floorScrollerY += this.floorDeltaY,\\n            _left = Math.random() * (this.canvasWidth - this.floorWidth);\\n        var floorConfig = this.getRandowFloor(this._floorRateArray);\\n        var floorElement = '<i class=\\\"floor ' + floorConfig.name + '\\\"></i>';\\n\\n        $(floorElement).css({\\n            top: _top,\\n            left: _left,\\n            width: this.floorWidth,\\n            height: this.floorHeight\\n        }).appendTo(this.$scroller);\\n    },\\n    /**\\n     * 移除楼层\\n     */\\n    removeFloorSapn: function () {\\n        $('.floor').eq(0).remove();\\n        this.floorScore++;\\n        this.updateScore();\\n    },\\n    /**\\n     * 更改血\\n     */\\n    updateBlood: function () {\\n        var $bloodEle = $('.blood i');\\n        for (var i = 0; i < $bloodEle.length; i++) {\\n            if (i < this.blood) {\\n                $bloodEle.eq(i).removeClass('lose');\\n            } else {\\n                $bloodEle.eq(i).addClass('lose');\\n            }\\n        }\\n    },\\n    /**\\n     * 修改分数\\n     */\\n    updateScore: function () {\\n        this.$container.trigger('scoreupdate');\\n        $('.text-score').text(this.floorScore);\\n    },\\n    /**\\n     * 失分数\\n     */\\n    loseBlood: function () {\\n        if (this.__onFloor) return;\\n        this.blood -= 0;\\n        //人变红\\n        this.$people.addClass('danger');\\n        setTimeout(function () {\\n            this.$people.removeClass('danger');\\n        }.bind(this), 1000);\\n\\n        //背影闪烁\\n        $('#game-ct').addClass('danger');\\n        setTimeout(() => {\\n            $('#game-ct').removeClass('danger');\\n        }, 100);\\n\\n        if (this.blood <= 0) {\\n            this.blood = 0;\\n            this.updateBlood();\\n            this.gameover();\\n            return;\\n        }\\n        this.updateBlood();\\n    },\\n    addBlood: function () {\\n        //当人物在平台上时，或者血量大于12，不重复加血\\n        if (this.__onFloor || this.blood >= 12) return;\\n        this.blood += 1;\\n        this.updateBlood();\\n    },\\n    floorNormal: function () {\\n        this.addBlood();\\n    },\\n    floorNail: function () {\\n        this.loseBlood();\\n    },\\n    floorWeak: function ($floorEle) {\\n        this.addBlood();\\n        setTimeout(function () {\\n            $floorEle.addClass('over');\\n            $floorEle[0].cross = true;\\n        }, 200);\\n    },\\n    floorScroll: function (direction) {\\n        this.addBlood();\\n        this.__floorScrollDirection = direction;\\n    },\\n    floorScrollEnd: function () {\\n\\n    },\\n    floorSpring: function () {\\n\\n    },\\n    jumpStart: function () {\\n\\n    },\\n    jumpEnd: function () {\\n\\n    },\\n    people: function () {\\n\\n    },\\n    floorUpdateView: function () {\\n\\n    },\\n    peopleUpdateView: function () {\\n\\n    },\\n    peopleUserController: function () {\\n\\n    },\\n    core: function () {\\n\\n    },\\n    run: function () {\\n\\n    },\\n    stop: function () {\\n\\n    },\\n    reRun: function () {\\n\\n    },\\n    backup: function () {\\n\\n    },\\n    start: function () {\\n        var _this = this,\\n            floorLoop = 0;\\n        this.$container.trigger('start');\\n        this.canvasWidth = $this.$canvas.width();\\n        this.canvasHeight = $this.canvas.height();\\n        this.floorDeltaY = this.canvasHeight / 11;\\n        this.floorWidth = this.canvasWidth / 5;\\n        this.floorHeight = this.canvasWidth / 9;\\n        this.peopleHeight = parseInt(this.$people.css('height'));\\n        this.peopleWidth = parseInt(this.$people.css('width'));\\n\\n        this._currentPeopleVertical = this.canvasWidth / 2 + this.peopleWidth / 2;\\n        this.backup();\\n        //初始化台阶\\n        while (floorLoop++ < 13) {\\n            this.createFloorSpan();\\n        }\\n        //初始化任务控制\\n        this.peopleUserController();\\n        //首次更新人物视图\\n        this.peopleUpdateView();\\n        //首次更新人物血量\\n        this.updateBlood();\\n        //首次更新楼层数\\n        this.updateScore();\\n        //以每秒60帧执行游戏动画\\n        this.run(this.fps);\\n    }\\n\\n}\\nexport default GameController;\"]}","code":"webpackHotUpdate(0,{10:function(t,o,e){\"use strict\";Object.defineProperty(o,\"__esModule\",{value:!0}),e(9),window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){t()};var i=function(){this.floorRate=[{name:\"normal\",rate:15},{name:\"spring\",rate:15},{name:\"weak\",rate:15},{name:\"scroller-left\",rate:10},{name:\"scroller-right\",rate:10},{name:\"nail\",rate:35}],this.fps=60,this.speed=50,this.maxSpeed=350,this.peopleVerticalSpeed=200,this.animation=null,this.canvasWidth=0,this.canvasHeight=0,this.floorWidth=0,this.floorHeight=0,this.floorDeltaY=50,this.floorScore=1,this.blood=12,this.$container=$(\".container\"),this.$canvas=$(\".game-canvas\"),this.$scroller=$(\".scroller\"),this.$people=$(\".people\"),this.peopleRotateZ=0,this.peopleRotateDelta=25,this.peopleHeight=0,this.peopleWidth=0,this._t=0,this._currentScrollerY=0,this._currentPeopleY=20,this._currentPeopleVertical=0,this._floorScrollerY=200,this._maxJumpDistance=0,this._frameIndex=0,this._v0=0,this.checkFloorConfig()};i.prototype={constructor:i,Event:[\"gameover\",\"start\",\"rerun\",\"stop\",\"scoreupdate\"],on:function(t,o){-1!==this.Event.indexOf(t)&&this.$container.on(t,o)},gameover:function(){this.stop(),setTimeout(function(){$(\"#game-ct\").hide(),$(\".game-over\").show()}.bind(this),200)},checkFloorConfig:function(){for(var t=0,o=this.floorRate,e=0;e<o.length;e++){var i=o[e].rate;if(\"number\"!=typeof i)throw new TypeError(\"rate type error\");t+=i}if(100!==t)throw new RangeError(\"rate 加起来务必等于100!\");this._floorRateArray=[0]},getRandowFloor:function(t){for(var o=100*Math.random(),e=0;e<t.length-1;e++)if(o>=t[e]&&o<t[e+1])return this.floorRate[e]},createFloorSpan:function(){var t=this._floorScrollerY+=this.floorDeltaY,o=Math.random()*(this.canvasWidth-this.floorWidth),e='<i class=\"floor '+this.getRandowFloor(this._floorRateArray).name+'\"></i>';$(e).css({top:t,left:o,width:this.floorWidth,height:this.floorHeight}).appendTo(this.$scroller)},removeFloorSapn:function(){$(\".floor\").eq(0).remove(),this.floorScore++,this.updateScore()},updateBlood:function(){for(var t=$(\".blood i\"),o=0;o<t.length;o++)o<this.blood?t.eq(o).removeClass(\"lose\"):t.eq(o).addClass(\"lose\")},updateScore:function(){this.$container.trigger(\"scoreupdate\"),$(\".text-score\").text(this.floorScore)},loseBlood:function(){if(!this.__onFloor){if(this.blood-=0,this.$people.addClass(\"danger\"),setTimeout(function(){this.$people.removeClass(\"danger\")}.bind(this),1e3),$(\"#game-ct\").addClass(\"danger\"),setTimeout(function(){$(\"#game-ct\").removeClass(\"danger\")},100),this.blood<=0)return this.blood=0,this.updateBlood(),void this.gameover();this.updateBlood()}},addBlood:function(){this.__onFloor||this.blood>=12||(this.blood+=1,this.updateBlood())},floorNormal:function(){this.addBlood()},floorNail:function(){this.loseBlood()},floorWeak:function(t){this.addBlood(),setTimeout(function(){t.addClass(\"over\"),t[0].cross=!0},200)},floorScroll:function(t){this.addBlood(),this.__floorScrollDirection=t},floorScrollEnd:function(){},floorSpring:function(){},jumpStart:function(){},jumpEnd:function(){},people:function(){},floorUpdateView:function(){},peopleUpdateView:function(){},peopleUserController:function(){},core:function(){},run:function(){},stop:function(){},reRun:function(){},backup:function(){},start:function(){var t=0;for(this.$container.trigger(\"start\"),this.canvasWidth=$this.$canvas.width(),this.canvasHeight=$this.canvas.height(),this.floorDeltaY=this.canvasHeight/11,this.floorWidth=this.canvasWidth/5,this.floorHeight=this.canvasWidth/9,this.peopleHeight=parseInt(this.$people.css(\"height\")),this.peopleWidth=parseInt(this.$people.css(\"width\")),this._currentPeopleVertical=this.canvasWidth/2+this.peopleWidth/2,this.backup();t++<13;)this.createFloorSpan();this.peopleUserController(),this.peopleUpdateView(),this.updateBlood(),this.updateScore(),this.run(this.fps)}},o.default=i}});","extractedComments":[]}